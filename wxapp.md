### taro微信小程总结经验

1. 使用taro自定义开发小程序的tarbar， 更改选中状态的时候， 不能够通过重新tabbar初始话的router的来判断，而是必须在组件里面写死，
并且切换下一个的时候， 用类组件的时候需要获取自定义tabbar实例更新内部selected， 而使用hooks的时候， 需要使用redux控制， 否则一直会慢半拍，一直选中的都是上一个的, 不能再组件内部控制, 最好不要使用自定义tabbar性能会有问题

2. 每次切换自定义的tabbar， tabbar组件会初始化两次， 这个还没有查到原因

3. 一般需要设置一个开发环境的环境切换机制，  长按弹出切换界面， 此时需要使用自定义的navigationStyle

4. 在存储storage数据的时候， 要根据环境，添加上环境字段， 避免测试环境和线上环境，切换环境的时候， 出现storage数据混乱的情况，比如将测试环境的storage数据带到线上

5. 用户登录的时候， 后端将根据微信login 返回的code+session_Key生成的token设置成无限期， 然后前端只判断checkSession是否过期， 在token存在情况下, 需要使用wx.getsetting获取， 是否有各种权限， 没有的话，主要我们弹出获取权限页面， 如果需要手动触发的话， 不要手动触发的话，直接弹出获取权限弹窗

6. 小程序底部tabbar只能使用图片不能使用图标，小程序的自带tab不能使用网络图片， 只能使用项目里的图片

7. 学生提交的图片使用前端直穿oss的方式， 提高性能， 需要后端给提供直穿url， 并且使用post请求直传，
小程序有自己的上传的api

8. cors跨域携带cookie的是问题， 需要在ajax 中配置withCredentials为true， 让cors跨域的时候，能携带上cookie值， 这里需要注意， 跨域请求能携带的cookie值， 只能是cookie源为自己的请求域名， 或者为当前跨域请求的父级域名

9. taro中的全局事件， 比如分享， 需要在页面中配置才生效， 在组件中配置是无效的

10. 在页面切换到其他页面的时候， 当前页面会被储存在页面栈中， 再次返回页面的时候， 页面内的状态数据， 都会保存，并且taro， 回退页面的时候useEffectE不会执行， useDidShow会执行，所以当回退需要初始化的操作时， 需要在useDidShow中覆盖原有值

