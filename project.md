## 项目总结

### 一、课程二维码项目：

```
踩坑：踩到了数字上下居中的坑，对移动端适配，又有了进一步了解,

主要用到的技术点：
    1、input   type=file的图片上传
    2、 react的renderProps

意义：解决了学生无法联系到老师的问题
```
### 二、Crm 项目
```
主要技术点：

1. 首次使用 antd pro 脚手架，踩了配置的坑, 主里面有几个必须项, 首先 antd pro 依附于 umi, config 的配置就是 umi 的 config 的配置, antd pro 的 css 是 cssmodule 的形式的, antd pro 提供了几个一些复杂的业务组件, 可以 npm 安装使用, 在项目中提供了预置的 layouts(容器组件), pages(页面), components(组成组件)
2. g2 可视化

3. 封装共用的form， table、查询区组件， 减少代码的冗余

踩坑：
1. 踩了 post 请求跨域的坑，(具体原因在收集问题的那里面写的全), 踩了 form 组合展示的坑(具体解决在收集问题的里面)
2. 踩了路由刷新的坑， 路由刷新 state 值就没有了, 只能通过 search 传的值才能保留
3. 自己第一次搭建了一个完整的项目, 知道了 nginx 服务是 web 的容器,
4. 首次使用了 g2 搞可视化，但是感觉有点不好用， 也是踩了一些坑， 现在是只能初始化设置了数据之后， 才能用 changedata 在更改数据， 不知道是不是我用的不对， 现在是这样， 有点不爽，还有就是图表需要 ajax 数据请求完毕在构建， 就是为了解决上面的问题，只能初始化设置了数据之后， 才能用 changedata 在更改数据， 这里感觉也是不太合理的

意义： 运营伙伴可以在工作台中根据饼图直观的查看课堂数据，在客户公海给运营伙伴分配跟进用户， 在我的客户中编辑跟进信息，方便运营伙伴记录跟进信息和统计工作量
```


### 三、m站课堂首页配置平台开发，（pc配置页面和m的配置结果展示页面都开发了）
### 做可配置的页面， 就是自己确定-套模板，然后就维护这套模板，就行了
```
技术点：
1. 实现拖拽排序， 可以使用 dragula 这个 npm 包

设计：
1. pc配置平台是分为三个部分， 组件选择区域， 预览区域， 右侧组件配置区域

2. pc配置平台是所见即所得的，保存后在m站显示的结果就是配置的结果

3. m站的展示也是根据自己确定的模板绘制的

4. pc配置平台在代码设置上也是可以配置的， 维护一套模板，控制页面的展示

5. 总结这种可以配置的界面， 所有东西尽量往模板里面放， 所有的配置字段， 使我们传的参数更少

6. 开发的时候要先写好静态页面， 然后在家逻辑， 不要磨蹭， 先快速搞完简单的， 然后在搞难的， 遇到超过两个小时的问题， 直接过， 之后在看

7. 经验,要将大块的， 重复的，封装成自定义hooks， 使用， 这样代码更好, 知道到了img的data-src 和src 配合实现图片的懒加载， data-src就是一个变量， 不会对图片有任何的影响

8. usememo 和 usecallback 要 看情况使用




踩坑：
1. 踩坑了 git 提交后构建的文件夹名字就是不对， 这个时候出现了混乱， 直接重新拉一遍项目就好了， 干别的都是徒劳

2. 要尽量整合到配置里面， 每一项所需要的属性， 这样就减少了props传递的数量, 设置元素的定位到当前， 直接设置元素的focus就可以， 同时需要设置元素的tabIndex， 在设置同意元素的时候， 要先删除之前设置过的tabIndex属性，否则在次设置聚焦就不生效了

3. 踩到的坑， useState的setState对之当前的state值进行操作后更新， 要在使用setState((prev) => {
    // 要使用这种方式完成， 要不然就会有获取不到正确的值的问题
    return prev;
})

意义： 提高了的m站课堂主页的可配置程度，导航栏、轮播图、专栏都支持配置，客户可以控制导航栏、专栏的显示，还可以添加多个专栏，并且可以调整专栏的展示顺序，使客户的课堂主页展示更加灵活，预览区域所见即所得，方便客户实时的查看自己的配置结果
```

### 四、pc站批量排课
```
技术点：
1. antd form自定义组件

意义： 解决了原来系列课中只能单节添加直播课，在需要大量排课的场景下，效率过低的情况
```
### 五、作业小程序项目
```
小程序端

技术点：
1. 使用taro搭建项目
2. 封装公共组件较少冗余代码
3. 选择图片， 拍照， 前端直传oss，图片预览，封装自己的redux，自定义

设计思路：封装通用组件集中使用

优化：
1、小程序包不能超过2m， 自己使用useReducer, useContext封装建议状态管理，减小包的大小（100k左右）
2、开发环境切换功能，长按选择切换请求路径， 方便测试切换环境
3、使用阿里云的裁切功能，在原有链接后面拼上参数， 返回小的图片用于预览展示， 提高页面渲染速度
4、减少作业列表每页条数， 提高选择速度
5、添加截流防止重复提交， 使用逻辑判断的方式， 而不是一个时间段， 因为逻辑判断更加准确

踩坑：

1. 使用taro自定义开发小程序的tarbar， 更改选中状态的时候， 不能够通过重新tabbar初始话的router的来判断，而是必须在组件里面写死，并且切换下一个的时候， 用类组件的时候需要获取自定义tabbar实例更新内部selected， 而使用hooks的时候， 需要使用redux控制， 否则一直会慢半拍，一直选中的都是上一个的, 不能再组件内部控制, 最好不要使用自定义tabbar性能会有问题， 这个有方法解决， 需要探究一下

2. 自定义tabbar会出现性能问题， 所以使用了默认提供的tabbar， 默认提供的tabbar必须使用图片，并且不能使用网络图片

3. 一般需要设置一个开发环境的环境切换机制，  长按弹出切换界面， 此时需要使用自定义navigationStyle，我们需要自定义顶部导航栏区域，这里需要使用粘连定位, 自定义顶部导航栏的时候， 要将手机顶部状态栏的高度扣除，顶部状态栏的高度通过getSystemInfoSync().statusBarHeight获得

4. 在存储storage数据的时候， 要根据环境，添加上环境字段， 避免测试环境和线上环境，切换环境的时候， 出现storage数据混乱的情况，比如将测试环境的storage数据带到线上

5. 用户登录的时候， 后端将根据微信login 返回的code+session_Key生成的token设置成无限期， 然后前端只判断checkSession是否过期， 在token存在情况下, 需要使用wx.getsetting获取， 是否有各种权限， 没有的话，主要我们弹出获取权限页面， 如果需要手动触发的话， 不要手动触发的话，直接弹出获取权限弹窗

6. 小程序底部tabbar只能使用图片不能使用图标，小程序的自带tab不能使用网络图片， 只能使用项目里的图片

7. 学生提交的图片使用前端直穿oss的方式， 提高性能， 需要后端给提供直穿url， 并且使用post请求直传，
小程序有自己的上传的api

8. cors跨域携带cookie的是问题， 需要在ajax 中配置withCredentials为true， 让cors跨域的时候，能携带上cookie值， 这里需要注意， 跨域请求能携带的cookie值， 只能是cookie源为自己的请求域名， 或者为当前跨域请求的父级域名

9. taro中的全局事件， 比如分享， 需要在页面中配置才生效， 在组件中配置是无效的

10. 在页面切换到其他页面的时候， 当前页面会被储存在页面栈中， 再次返回页面的时候， 页面内的状态数据， 都会保存，并且taro， 回退页面的时候useEffectE不会执行， useDidShow会执行，所以当回退需要初始化的操作时， 需要在useDidShow中覆盖原有值

11. 在微信后台配置二维码， 需要需要配上，请求后端接口的那个域名， 然后在配上页面的路径， 最后后端拼接上想给我们的参数，然后前端在userouter的prams 的p上取到穿过来的参数， 参数是通过encodeURIComponent加密的， 需要解密后才能使用

12. 小程序的图片安全校验是调用微信提供的校验接口的， 后端才能能调

13. 小程序中文字和text元素在一起显示的时候，text中的文字需要超过几个字展示..., 这个时候不能使用css控制， 因为text无法设置宽度， 如果改为inline-block后， text元素中的字体会偏上，不会和其他字体在一行， 所以解决方式是， 确定最多展示几个字显示...,通过js控制在超过字数的时候截取字体加上...,在进行展示

14. 需要回显用户输入的空格和换行， 直接使用textArea组件， 就是支持回显， 换行是默认支持的， 当时
空格需要配置 scope=nbsp

15. 写三角形，只需要不设置元素宽高， 通过设置border的宽度就可以实现

16. 可以给textArea直接设置padding，不让内部的placeHolder和内部的文字贴边

17. 可以通过getImgInfo获取到图片的类型， 进行类型判断

18. 通过添加截流解决重复请求的问题

19. 优化首页渲染速度， 减少每页条数， 提前分页请求的时机

20. 图片使用腾讯安全校验，图片过大导致校验事件过长， 超过三十秒就被判定为验证失败，所以解决方法，需要在验证的时候压缩图片

21. 手机上微信会自动对选择的图片进行压缩， 即使选择的是原图，所以会导致我们选择图片后获取到的图片大小， 要小于图片原有的大小， 所以按照原有大小逻辑进行校验的话， 会出现错误

22. 图片预览的时候， 如果传入的路径是相同，会被默认认为是同一张图片， 可以在路径上拼接一个自定义query进行区分

23. 原生textarea和input层级过高的问题是以为聚焦导致的， 解决方法就是让他们失焦就好了

24. 小程序批改，和竞品比对也考虑性能和维护成本， 所以选用fabric.js canvas框架， 使用webview的形式实现的

25. 小程序使用webview， 需要后端帮忙存储过程数据， 并且需要小程后台配置，需要请求的业务域名， 否则无法在
webview中加载对应域名下的资源， 并且需要在业务域名的资源根路径放一个在微信公众平台下载的txt文件

26. 小程序设置请求的header的时候， 小程序会将请求头上的大写字段统一转成小写

27. 在css中可以给一个苹果手机的底部距离用于， 优化页面展示，constant(safe-area-inset-bottom);
，env(safe-area-inset-bottom); 顺序不可以调换, 两个都要加，就是给我们一个具体的值

28. 小程序中使用lodash会报错， 因为小程序对一些js的原生函数的支持和浏览器的支持不同， 所以导致报错
```
```
pc端：
技术点：
1. 使用canvas封装公共的批改组件
2. 封装公共组件table、form、search 组件，减少冗余代码
3. pc端图片上传预览、音频上传预览
4. 图片直传oss提高用户体验， 提高性能
5. 使用cors跨域， 这个时候携带父域名的cookie， 需要在ajax中配置  withCredentials为true
6. 前端直传oss，需要前端这边和后端先确定文件的名称， 前端将名称传给后端， 然后在用相同的名称给oss传文件， 等上传文件完成后， 在想后端请求，文件资源路径， 然后根据之前前端传给后端的文件名称， 返回给前端对应的资源请求路径

优化：
1、添加截流防止重复请求
2、使用阿里云的裁切功能，在原有链接后面拼上参数， 返回小的图片用于预览展示， 提高页面渲染速度


难点：
1. canvas计算， 封装canvas批改组件， 计算定位， 打勾，打叉，旋转

2. 前端图片直传oss， 没有相关的实际实践， 通过官方文档， 摸索尝试， 实现oss直传,

3. 图片太大，20m左右直传后， 后端调用腾讯安全校验超时， 导致提交图片失败
解决方案：分片上传，每次直传oss后， 向后台发送通知请求的时候，后台就进行安全校验，校验通过后返回图片路径， 和当前检验过的图片的对应token标识， 如果校验不通过直接抛错，再提交后台保存的时候，需要带上后台返回的图片token

4. 前端进行图片类型判断， 用户可能更改文件后缀， 使用file的检验不靠谱，

解决方法：这个需要使用arraybuffer检验二进制文件的数据类型

5. 前期需求没有确实， 讨论需要占用前期过长时间，导致压缩开发排期， 时间比较急,

6. oss直传导致的， canvas 绘制跨域的图片， 需要给 图片实例设置 image.setAttribute('crossOrigin', 'anonymous'); 这样canvas才有可能可以绘制的图片，但是一般不太行， 这样做不稳定，所有有两种解决方案：
1. 在阿里云的nginx配置, 允许cors的域名， 加入我们的网站的域名，让我们可以绘制跨域的图片
2. 服务端获取到oss的资源， 然后转成base64的格式，返回给前端， 但是图片太大的话转成base64字符串就会很长，所以得不偿失
3. 后端操作获取oss资源， 再将图片存在一个前端能跨域的地址， 给前端返回那个地址
4. 前端直传oss遇到坑， 第一次直传后可以在canvas上绘制图片， 第二次打开canvas绘制图片报跨域问题，
这是因为oss那边设置了304缓存， 导致第二次使用本地的缓存资源的时候， 触发了浏览器跨域， 解决的方式就是， 不设置304缓存， 每次都请求新的就可以了
5. 前端直传oss不见得是最好的方式， 因为这样没有后端传可控

7. 回显用户输入空格和换行， 使用正则匹配字符串换行， 将他换成br标签， 批改空格替换成&nbsp，最后将这个字符串使用dangerouslySetInnerHTML添加到一个div中展示

8. 使用withRouter包裹后的组件， 能够在props中获取router实例，在上面能够获取到监听切换路由的事件setRouteLeaveHook, 在这个事件回调中返回true，允许切换路由， 返回false就不允许切换, 还有在from.create中可以注册valueChange监听事件， form中的值变化后这个事件就会执行，使用这两个事件实现， 作业创建页面修改后， 离开页面会弹出二次确认弹窗的功能, 只要是要离开路由的页面都会触发setRouteLeaveHook事件

9. 图片使用腾讯安全校验，图片过大导致校验事件过长， 超过三十秒就被判定为验证失败，所以解决方法，需要在验证的时候压缩图片

10. 前端直接请求文件地址， 通过location.href,这样浏览器会自动识别，资源内容直接展示，不会下载文件到本地，通过location.href下载地址可以下载保存文件到本地


踩坑：
1. 前期接口对不不好， 导致后期联调的时候， 出现问题， 联调时间长
2. 图片大小过大， 没有压缩， 导致上传时间过长， 图片加载时间过长
3. 作业和班级的每页条数太多， 导致加载过慢， 首屏性能不好
```
代码编写上的收获：
1、每个函数不超过三个函数，超过三个函数的使用柯理化， 在穿出来一个函数， 接着调用，或者使用promise调用
2、封装hooks, 只封装一层就行了， 不要传超过三个参数
3、业务逻辑放在组件中， 将公共的逻辑提到公共的文件中
4、最好不要在父组件中操作子组件，或者在子组件中批改父组件， 将逻辑直接放到子组件和或者直接放到父组件中
5、写功能之前要想清楚， 想顺了， 写的时候就顺了



## 经验积累

### 一. 做项目的准备和步骤

1. 以后做项目，要自己理解需求， 然后根据需求设计完整的方案，根据方案写好逻辑注释
2. 开发之前一定要写技术文档， 写出需要用的技术， 和不知道用什么技术实现的， 和所用技术的难点
3. 要全局， 把整个流程都捋通，把整个流程的注释都写好， 然后根据捋好的注释一气呵成完成开发，
4. 要不然开发都是迷糊的，漏洞百出， 这里的全局逻辑可以写在一个单独的文本文件中，具体的逻辑可以写在对应的组件文件中， 然后把这些东西整理成设计文档， 用于评审， 这样才能清晰的开发
5. 一定要看了要开发代码之后才能评估，需要的开发时间，，最好是先开发一段时间在评估时间，一定要把写样式的时间算进去
6. 开发的时候要先写好静态页面， 然后在家逻辑， 不要磨蹭， 先快速搞完简单的， 然后在搞难的， 遇到超过两个小时的问题， 直接过， 之后在看
7. 一定要边开发， 边看需求文档确认, 不要被ue图蒙蔽
8. 提测之前一定要把所有的功能过一遍， 要细， 把bug控制在一定数目以下

开发前一定要看代码，根据实际复杂程度分析

做好思考， 有问题积极复盘， 总结原因， 提升自己, 评时间一定要把会议、周五还有、上线算进去



react-native 问题总结


搭建环境

1. 需要react-native link  在安卓和ios项目中全局安装

2. ios项目pods的安装可能有问题， 需要在ios目录下手动pod install 重新安装


3. [!] No podspec found for `RNVectorIcons` in `../node_modules/react-native-vector-icons`  缺少图标依赖  ， 解决方式 yarn add react-native-vector-icons

4. 要先启动安卓模拟器， 才能启动安卓项目， 如果模拟器不自动启动的话

5. 安卓除了编译器还有很多jdk的版本需要符合

6. java 版本需要是11

7. 安卓启动报错 Error:Execution failed for task ':app:validateSigningDebug'. > Keystore file D:\Android_keystore\deb  解决方式： 把安卓staio里面把Store File里指定的Keystore文件的路径删除就可以了
